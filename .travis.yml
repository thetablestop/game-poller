if: tag IS blank
language: node_js
node_js:
- 12
env:
  matrix:
  - VERSION_PREFIX=1.0
  global:
  - secure: Ooahl0Wa883QXB5UEBb7i0zlHkr9gulgYh8SR2YVXnxduekX75OfVo24H02xQBw2byrNXU/u1KNFky4ZiXo/tQyU1I435BFmOCNAu0A86MBtvNZKq+kBjtx20JzG8tY9rBrZW5RFH1afBbsQMEEat/x4UPk/j+I9XniwpXo7esXqpFFPZX4kyRPHANNb4uJt4JwyXDwY5Xi56JJbgZHPh4zvFLQS9yR1WachN/xMIZ1RNTBPqYIpblwdDre4b1FsPdv2OX0MVA4d6nxqR0XR0IjgBz2KcpSi+15pXQfU3dyBqE99IRMniDdkTPV+W/gF80O9f4fjwN+ezDZ5cSvxXO7qMYZbb9HAluLfh7ovHuDhT7SRr1RndhROUhOgnEoQk2FwHdtozHBONSG4+DvHWM7XK0JM5G6n5ETmXhQvL8T1+6/fKPymfs/QCP6tZXX8IHh3S9UPqsw2K+R4fhrfO/GYvaNGAhbDGxdCvGG9lEemJ741yj+owpoajzl4JAxDplaOK1yqlLkB2KlVYQeQp930WiM/n4JEjgEgXyT2DATTU69DFoeFxoOpjUsxIeez6ph5BXMLMtM7kT0HAuAVezZmUzU81yS800n9i5BEETckMr/6Q2187Wx81ZsyAdRViS4Fd3CDEjdqpd0NkrQzp4nBGjlcETba4nd07PIrbeU=
  - secure: CjHZTYWKQQ9mvAYZRsvUcVDPMbm/7ZftwlZ8BSzR7lZ4iaMTT0PBKaFQqvTCUAcLYfax5W/7Hym+OOxaEoQovmmBAhc8gRF0fxBAodCIsOZ/7XMbrJLcoNS8I6U7p1qEOyNLQQqx9srMea7NS1eV4d45tDNUuS3r3Eqkx7fZilLena99Eqpk3UQzgH2nGZsxA3TY+BVGpBstH1raSD/HtEwDHi7sNO+VE073lorHLZSv2ga8xgYqQIZbXapuFp2jLtYLjesAmK3xxb4tL/n0oS8/MAtIfDpT3lUlTIhwrCZLIpLxU/8yqlH83NK0UZgoMG2fUPQdc2Al5FPpKfCHD6zKJi86izt1U0wxdqgBO6ZFeXqCpPMNouaitXjrCIjw7WIuayW2ZAdYwc/6sas6EQlD96EJ6fUZba6JSmajkKM0YyqnUJO9ICSdTydBaFLing0IERqP2zbRlBakUHHONpURJAYEx6D/i4HrA5GcLZXs2Y5g+MmBJUh7SZXRCoYjgf01IaKHIetw4bYpPy6W7kvz+m95j1/fL8EG4LWz4tC81rTsDvFZU6VxavOREXF0aJIcCAEIhAYGM1mOJLGapW+6eBcVF7F/T/Lui+NlUxvLNf7xrrs9TGsDYQQKcZjXlPLqPt75D59AOGZ9jti7Tja2M89mRlx6GR1sPixShSg=
  - secure: JqldwmfSR4im9A2+XN/l5pem1Sq11Kgb4vpDcTwV9Unsw2Pw97CUj8VGGZ84m2Ak2m1UxZR+4bumWXbJvrZ7uzXa+IV9//2AyFHt/em682N0yCvXP2qxEUrlbzYGHEkQIYXIjeFpL+Brf5PrJSGFZjmBj59eZn8J9VLkUPM3s2AA/LR68x8EXaWKyIEZnKHTc+bU6mhypduEcOBW9SLMsXb/HkkxsD2w6NHHhSFJb8TUV/5kOAIbVR80YHdM1ugspdYY5gyT1JDWMklnlhBlmApvyR7T2nc75ftfumtmXlpYvUgSAjm/xzBmWO0ZhLxLuEL/u3s7OaKpksXs2Nduzk9SzBE97NC1/JS/u+9G2L9U7+5Ygehs/ZJ6phVyyaBtokbL0n5PTUT0c+9kk+j6yQ0mV2XmcfBDk7bJm/r5b1swV+Q2jEo16mF+hT6kHYC1bpkOBYyFbQLlJf7Dm4jL+/9eIzgGF6tzp7UAwzHvST7ar1xhsKfcNCJSJteFQ7Ly0H2Q9xxMoux1xLzIZpAUrhhVDMWF0m2xFRpuh4J1vOOJ8PQVrbteGxA6TANtu9fd3M8vxueMWOC4aKLB4NwHmBXDMsJgXhsjy1s+fi7XpZjfA5ASKKDpLK/OL4rVXjQuEhhajB2D32EINNFXt9wFGSnh/dyL9/BNnCp/pxP6Shs=
  - secure: ltCsnsXRoVz4nLeLi/M49NOh6ZyI8IMQHRTVaEdChtwp/c8txrLS6kXQH7arUljauqqL1cW1bnwU0Me4E38zEmTHCzxK9eaWlOmsifeU+zd4aML5m7U/kmsTUa+jEgeczZVR3bqGvYobTVJgme4hE3eAVBl1u9wBwwoYlCpI9FjsFMmSF5dWuUU1gXhkDZdR9L1DKzyXGDBGiOjIBnopU6kIe/YHjYm+YtXPKM/WtZYE7N4NOu8NKOkuHWz7jO15IlSJme9exwVE9h0/I4mmTlvFnt01N5S2kiD9NNydvgF9Xoab5qAGpOSkfISp4rNE+0i8dHWCO149OoJlQVXK3LSpSAulaCbk3yE2XkyRqWlMsXT7AN6R2loSF0be2c4/PmpswmgzbbWqrYDdwSg3XT8Z8d9pitWRYm09ZnpDFcmQTxdhG7i6IdiPAQm3TMxWtpsi9Kpj64fvpJS2ak19v3hJhCY0Fj8nxZXS4Bb1dxmEKIfLQ875Q0lQ1Z9gMbYl3HROIJLObgHJOABqUhRnuhaTs3T7VLVT1+I+8jV3HZN6/4f3iqvHoXmdxRvGJ/jNJxCjy8rJrEwOiRus9WMOHvHP5rUC7A9FDZbRFcGx92zfNd5czgKQpBpH0LCEbdYH3Lbju14/SgLsPKG8l00Igp9ork6fUq2+eWjrGHT+ETg=
notifications:
  slack:
    secure: IJ1bbRXzSQeLMmA/wdmcjwTynBk/w0mEAK6MhfQUZ36LQGZ2OHgLvqGMQvg+QFYO6nTP+UF4H0fr6U8FySUW2ww0K9h5NyxiuSCQdlRqjiAcliqJNkTo2e9r8mR+4NVeQ7QrAcEQ2pMl8J293KbT38Gnk8EOOtG31FXz+jFdjTVS0IQn6ZBlywmohVceoc/WFBPDfbe1t/Rv0qjg737MKCd4S0Bta71CSIOFQODP40RbVD9QuF8Mt0o6630e12TH+0/aXH9OH2L9fMJSLY0CewJ863+7QFN/li95xSZ0Q2RN4gXJTpdth8uodXTmYHHU5WKGIJjFaj5tyvj0WqMt1HvWXVanNx7shrnOk5vXFqCeYUVVzETQ/f0PFmlJBibge0CEM0UhqRn7xpE1wEj+W7F2pU4fd0D02X3an3PD/w3OSUIb+R9YiCi0jT9bKOfu7MCP5oZYbT/QDMFfex+zm9NX7UJUJB9U7nQVH3MF8Ltg3pYaBxh0FUPircVgpVNJSRLCTydwLLlVyKVuyOJloxTCTj6t1A1AhFL3VmkPuw7Eloqk2lRhacIVFD7SsWcFK4IX8n3othh65em/nSDgOlm+OT1myE4uJa6EoalUyLW5TG9iDHE8/YF9Oc3+NxFrGbujvKH/Vu1QiQ1DIoc5mnLOrCdbWG5/9iDtcmKaSns=
services:
- docker
jobs:
  include:
  - node_js: 12
  - stage: deploy
    if: "(NOT type IN (pull_request)) AND (branch = master)"
    script:
    - export FULL_VERSION=$VERSION_PREFIX.$TRAVIS_BUILD_NUMBER
    - export REPO_TAGGED=$TRAVIS_REPO_SLUG:$FULL_VERSION
    - export REPO_LATEST=$TRAVIS_REPO_SLUG:latest
    - echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker build -t $REPO_TAGGED .
    - docker tag $REPO_TAGGED $REPO_LATEST
    - docker push $REPO_TAGGED
    - docker push $REPO_LATEST
    - git config --global user.email "builds@travis-ci.com"
    - git config --global user.name "Travis CI"
    - git remote add tagorigin https://$GH_USERNAME:$GH_TOKEN@github.com/$TRAVIS_REPO_SLUG.git
    - git tag $FULL_VERSION -a -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
    - git push tagorigin --tags
